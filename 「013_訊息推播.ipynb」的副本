{"cells":[{"cell_type":"code","execution_count":1,"metadata":{"id":"QUmyHyZ3cnZI","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1652862742849,"user_tz":-480,"elapsed":15828,"user":{"displayName":"JIA-JING LIU","userId":"14261637597037966153"}},"outputId":"0be8722c-2a13-4cc6-d728-530bd410507c"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["'''\n","\n","資料 mapping 至google drive\n","\n","把資料寫在/content/drive\n","\n","即可保存在 google drive內\n","\n","'''\n","from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","execution_count":2,"metadata":{"id":"IA4MtQz7c4vK","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1652862768331,"user_tz":-480,"elapsed":8997,"user":{"displayName":"JIA-JING LIU","userId":"14261637597037966153"}},"outputId":"b3afbd83-8d83-4baa-ba45-598cf27ce67b"},"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting line-bot-sdk\n","  Downloading line_bot_sdk-2.2.1-py2.py3-none-any.whl (87 kB)\n","\u001b[?25l\r\u001b[K     |███▊                            | 10 kB 24.6 MB/s eta 0:00:01\r\u001b[K     |███████▌                        | 20 kB 12.1 MB/s eta 0:00:01\r\u001b[K     |███████████▎                    | 30 kB 8.9 MB/s eta 0:00:01\r\u001b[K     |███████████████                 | 40 kB 4.9 MB/s eta 0:00:01\r\u001b[K     |██████████████████▊             | 51 kB 4.5 MB/s eta 0:00:01\r\u001b[K     |██████████████████████▌         | 61 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████▏     | 71 kB 5.5 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████  | 81 kB 6.0 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████████| 87 kB 3.4 MB/s \n","\u001b[?25hRequirement already satisfied: flask in /usr/local/lib/python3.7/dist-packages (1.1.4)\n","Collecting flask-ngrok\n","  Downloading flask_ngrok-0.0.25-py3-none-any.whl (3.1 kB)\n","Requirement already satisfied: requests>=2.0 in /usr/local/lib/python3.7/dist-packages (from line-bot-sdk) (2.23.0)\n","Collecting aiohttp>=3.7.4\n","  Downloading aiohttp-3.8.1-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (1.1 MB)\n","\u001b[K     |████████████████████████████████| 1.1 MB 36.9 MB/s \n","\u001b[?25hRequirement already satisfied: future in /usr/local/lib/python3.7/dist-packages (from line-bot-sdk) (0.16.0)\n","Requirement already satisfied: attrs>=17.3.0 in /usr/local/lib/python3.7/dist-packages (from aiohttp>=3.7.4->line-bot-sdk) (21.4.0)\n","Collecting async-timeout<5.0,>=4.0.0a3\n","  Downloading async_timeout-4.0.2-py3-none-any.whl (5.8 kB)\n","Collecting asynctest==0.13.0\n","  Downloading asynctest-0.13.0-py3-none-any.whl (26 kB)\n","Collecting yarl<2.0,>=1.0\n","  Downloading yarl-1.7.2-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (271 kB)\n","\u001b[K     |████████████████████████████████| 271 kB 52.8 MB/s \n","\u001b[?25hCollecting aiosignal>=1.1.2\n","  Downloading aiosignal-1.2.0-py3-none-any.whl (8.2 kB)\n","Requirement already satisfied: charset-normalizer<3.0,>=2.0 in /usr/local/lib/python3.7/dist-packages (from aiohttp>=3.7.4->line-bot-sdk) (2.0.12)\n","Collecting multidict<7.0,>=4.5\n","  Downloading multidict-6.0.2-cp37-cp37m-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (94 kB)\n","\u001b[K     |████████████████████████████████| 94 kB 2.2 MB/s \n","\u001b[?25hCollecting frozenlist>=1.1.1\n","  Downloading frozenlist-1.3.0-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (144 kB)\n","\u001b[K     |████████████████████████████████| 144 kB 60.5 MB/s \n","\u001b[?25hRequirement already satisfied: typing-extensions>=3.7.4 in /usr/local/lib/python3.7/dist-packages (from aiohttp>=3.7.4->line-bot-sdk) (4.2.0)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests>=2.0->line-bot-sdk) (2.10)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests>=2.0->line-bot-sdk) (3.0.4)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests>=2.0->line-bot-sdk) (1.24.3)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests>=2.0->line-bot-sdk) (2021.10.8)\n","Requirement already satisfied: Werkzeug<2.0,>=0.15 in /usr/local/lib/python3.7/dist-packages (from flask) (1.0.1)\n","Requirement already satisfied: itsdangerous<2.0,>=0.24 in /usr/local/lib/python3.7/dist-packages (from flask) (1.1.0)\n","Requirement already satisfied: Jinja2<3.0,>=2.10.1 in /usr/local/lib/python3.7/dist-packages (from flask) (2.11.3)\n","Requirement already satisfied: click<8.0,>=5.1 in /usr/local/lib/python3.7/dist-packages (from flask) (7.1.2)\n","Requirement already satisfied: MarkupSafe>=0.23 in /usr/local/lib/python3.7/dist-packages (from Jinja2<3.0,>=2.10.1->flask) (2.0.1)\n","Installing collected packages: multidict, frozenlist, yarl, asynctest, async-timeout, aiosignal, aiohttp, line-bot-sdk, flask-ngrok\n","Successfully installed aiohttp-3.8.1 aiosignal-1.2.0 async-timeout-4.0.2 asynctest-0.13.0 flask-ngrok-0.0.25 frozenlist-1.3.0 line-bot-sdk-2.2.1 multidict-6.0.2 yarl-1.7.2\n"]}],"source":["'''\n","\n","'''\n","\n","!pip install line-bot-sdk flask flask-ngrok"]},{"cell_type":"code","execution_count":3,"metadata":{"id":"vznr93WgdCkd","executionInfo":{"status":"ok","timestamp":1652862774300,"user_tz":-480,"elapsed":403,"user":{"displayName":"JIA-JING LIU","userId":"14261637597037966153"}}},"outputs":[],"source":["from linebot import (\n","    LineBotApi, WebhookHandler\n",")\n","from linebot.models import (\n","    \n","    TextSendMessage\n",")\n"]},{"cell_type":"code","execution_count":4,"metadata":{"id":"gBxudgmsdMLj","executionInfo":{"status":"ok","timestamp":1652862787107,"user_tz":-480,"elapsed":472,"user":{"displayName":"JIA-JING LIU","userId":"14261637597037966153"}}},"outputs":[],"source":["\n","# 生成實體物件\n","line_bot_api = LineBotApi(\"lSRXXK98162m7Q+kBr64eBxc9tV9FaNDf5cUXtDF2M8ljxITO86UTkf0MyMROwaA5aU3NGhN7ic+DswXldXarwEhuFaJP2I/T+3/OEGYK6mPkXr9pi8kMKrq9gntscNDRQRe40ZjpoWM/UqW7l1LbAdB04t89/1O/w1cDnyilFU=\")"]},{"cell_type":"code","execution_count":5,"metadata":{"id":"N4IwX0MydOPN","executionInfo":{"status":"ok","timestamp":1652862848183,"user_tz":-480,"elapsed":654,"user":{"displayName":"JIA-JING LIU","userId":"14261637597037966153"}}},"outputs":[],"source":["'''\n","指定推播\n","'''\n","# 單一推送器\n","# 用戶ID，要傳送的消息\n","line_bot_api.push_message('Uf57398b2870127a0567cc1fc518d93e0', TextSendMessage(text='Hello World!'))"]},{"cell_type":"code","execution_count":7,"metadata":{"id":"5JSs8yHpcc1a","colab":{"base_uri":"https://localhost:8080/","height":236},"executionInfo":{"status":"error","timestamp":1652867024995,"user_tz":-480,"elapsed":413,"user":{"displayName":"JIA-JING LIU","userId":"14261637597037966153"}},"outputId":"d8e639a9-4185-4435-99cd-c9ea125cbb0c"},"outputs":[{"output_type":"error","ename":"FileNotFoundError","evalue":"ignored","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mFileNotFoundError\u001b[0m                         Traceback (most recent call last)","\u001b[0;32m<ipython-input-7-d01e554de2ed>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m()\u001b[0m\n\u001b[1;32m      4\u001b[0m \u001b[0;31m# 載入用戶ID列表\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      5\u001b[0m \u001b[0;32mimport\u001b[0m \u001b[0mjson\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 6\u001b[0;31m \u001b[0mjson_object_strings\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mopen\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"/content/drive/MyDrive/users.txt\"\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m'r'\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      7\u001b[0m \u001b[0mjson_array\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m[\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      8\u001b[0m \u001b[0muser_id_array\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m[\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mFileNotFoundError\u001b[0m: [Errno 2] No such file or directory: '/content/drive/MyDrive/users.txt'"]}],"source":["'''\n","廣播\n","'''\n","# 載入用戶ID列表\n","import json\n","json_object_strings = open(\"/content/drive/MyDrive/users.txt\",'r')\n","json_array = []\n","user_id_array = []\n","\n","# 把每一條內容都轉成json檔，變成json array\n","for json_object_string in json_object_strings:\n","    json_object = json.loads(json_object_string)\n","    json_array.append(json_object)\n","\n","# 從json array中挑出用戶ID\n","for user_record in json_array:\n","    user_id_array.append(user_record.get(\"user_id\"))\n","\n","# multicast\n","# 指定一群用戶ID\n","# [xxxSend, xxxSend]，一次可以傳5則\n","line_bot_api.multicast(\n","    user_id_array,\n","    TextSendMessage(text='Hello World!')\n",")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"0YUQOJyRZepG"},"outputs":[],"source":[""]}],"metadata":{"colab":{"collapsed_sections":[],"name":"「013_訊息推播.ipynb」的副本","provenance":[{"file_id":"https://github.com/BingHongLi/ai-chatbot-tutorial/blob/main/014_%E8%A8%8A%E6%81%AF%E6%8E%A8%E6%92%AD.ipynb","timestamp":1652862714748}]},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.8.6"}},"nbformat":4,"nbformat_minor":0}