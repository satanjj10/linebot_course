{"cells":[{"cell_type":"code","execution_count":null,"metadata":{"id":"ixe3063uLzTs"},"outputs":[],"source":["'''\n","\n","用戶菜單功能介紹\n","\n","    用戶能透過點擊菜單，進行我方希冀之業務功能。\n","    \n","流程\n","    準備菜單的圖面設定檔\n","    讀取安全設定檔上的參數\n","    將菜單設定檔傳給Line\n","    對Line上傳菜單照片\n","    檢視現有的菜單\n","    將菜單與用戶做綁定\n","    將菜單與用戶解除綁定\n","    刪除菜單\n","\n","'''"]},{"cell_type":"code","execution_count":2,"metadata":{"id":"TKXAcG35LzTw","executionInfo":{"status":"ok","timestamp":1652861479818,"user_tz":-480,"elapsed":281,"user":{"displayName":"","userId":""}}},"outputs":[],"source":["'''\n","菜單設定檔\n","\n","    設定圖面大小、按鍵名與功能\n","    \n","'''\n","\n","menuRawData=\"\"\"\n","{\n","  \"size\": {\n","    \"width\": 2500,\n","    \"height\": 1686\n","  },\n","  \"selected\": true,\n","  \"name\": \"區塊鏈自定義菜單\",\n","  \"chatBarText\": \"查看更多資訊\",\n","  \"areas\": [\n","    {\n","      \"bounds\": {\n","        \"x\": 5,\n","        \"y\": 0,\n","        \"width\": 824,\n","        \"height\": 850\n","      },\n","      \"action\": {\n","        \"type\": \"message\",\n","        \"text\": \"[::text:]傳統交易\"\n","      }\n","    },\n","    {\n","      \"bounds\": {\n","        \"x\": 0,\n","        \"y\": 850,\n","        \"width\": 825,\n","        \"height\": 818\n","      },\n","      \"action\": {\n","        \"type\": \"message\",\n","        \"text\": \"[::text:]第三方公證人\"\n","      }\n","    },\n","    {\n","      \"bounds\": {\n","        \"x\": 829,\n","        \"y\": 5,\n","        \"width\": 871,\n","        \"height\": 849\n","      },\n","      \"action\": {\n","        \"type\": \"message\",\n","        \"text\": \"[::text:]多位公證人\"\n","      }\n","    },\n","    {\n","      \"bounds\": {\n","        \"x\": 825,\n","        \"y\": 854,\n","        \"width\": 875,\n","        \"height\": 814\n","      },\n","      \"action\": {\n","        \"type\": \"message\",\n","        \"text\": \"[::text:]多組織多位公證人\"\n","      }\n","    },\n","    {\n","      \"bounds\": {\n","        \"x\": 1700,\n","        \"y\": 0,\n","        \"width\": 800,\n","        \"height\": 858\n","      },\n","      \"action\": {\n","        \"type\": \"message\",\n","        \"text\": \"[::text:]教學訊息\"\n","      }\n","    },\n","    {\n","      \"bounds\": {\n","        \"x\": 1700,\n","        \"y\": 858,\n","        \"width\": 800,\n","        \"height\": 810\n","      },\n","      \"action\": {\n","        \"type\": \"message\",\n","        \"text\": \"[::text:]more\"\n","      }\n","    }\n","  ]\n","}\n","\"\"\""]},{"cell_type":"code","source":["!pip install line_bot_sdk"],"metadata":{"id":"UqUXJvZNNMbC","executionInfo":{"status":"ok","timestamp":1652861490345,"user_tz":-480,"elapsed":8171,"user":{"displayName":"","userId":""}},"outputId":"d976f948-47ce-448a-a360-d5d88c8faee7","colab":{"base_uri":"https://localhost:8080/"}},"execution_count":3,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting line_bot_sdk\n","  Downloading line_bot_sdk-2.2.1-py2.py3-none-any.whl (87 kB)\n","\u001b[?25l\r\u001b[K     |███▊                            | 10 kB 18.4 MB/s eta 0:00:01\r\u001b[K     |███████▌                        | 20 kB 22.9 MB/s eta 0:00:01\r\u001b[K     |███████████▎                    | 30 kB 4.3 MB/s eta 0:00:01\r\u001b[K     |███████████████                 | 40 kB 5.6 MB/s eta 0:00:01\r\u001b[K     |██████████████████▊             | 51 kB 5.7 MB/s eta 0:00:01\r\u001b[K     |██████████████████████▌         | 61 kB 6.7 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████▏     | 71 kB 6.8 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████  | 81 kB 7.6 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████████| 87 kB 3.8 MB/s \n","\u001b[?25hRequirement already satisfied: future in /usr/local/lib/python3.7/dist-packages (from line_bot_sdk) (0.16.0)\n","Requirement already satisfied: requests>=2.0 in /usr/local/lib/python3.7/dist-packages (from line_bot_sdk) (2.23.0)\n","Collecting aiohttp>=3.7.4\n","  Downloading aiohttp-3.8.1-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (1.1 MB)\n","\u001b[K     |████████████████████████████████| 1.1 MB 17.3 MB/s \n","\u001b[?25hCollecting async-timeout<5.0,>=4.0.0a3\n","  Downloading async_timeout-4.0.2-py3-none-any.whl (5.8 kB)\n","Requirement already satisfied: typing-extensions>=3.7.4 in /usr/local/lib/python3.7/dist-packages (from aiohttp>=3.7.4->line_bot_sdk) (4.2.0)\n","Requirement already satisfied: charset-normalizer<3.0,>=2.0 in /usr/local/lib/python3.7/dist-packages (from aiohttp>=3.7.4->line_bot_sdk) (2.0.12)\n","Requirement already satisfied: attrs>=17.3.0 in /usr/local/lib/python3.7/dist-packages (from aiohttp>=3.7.4->line_bot_sdk) (21.4.0)\n","Collecting yarl<2.0,>=1.0\n","  Downloading yarl-1.7.2-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (271 kB)\n","\u001b[K     |████████████████████████████████| 271 kB 64.3 MB/s \n","\u001b[?25hCollecting aiosignal>=1.1.2\n","  Downloading aiosignal-1.2.0-py3-none-any.whl (8.2 kB)\n","Collecting asynctest==0.13.0\n","  Downloading asynctest-0.13.0-py3-none-any.whl (26 kB)\n","Collecting multidict<7.0,>=4.5\n","  Downloading multidict-6.0.2-cp37-cp37m-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (94 kB)\n","\u001b[K     |████████████████████████████████| 94 kB 3.4 MB/s \n","\u001b[?25hCollecting frozenlist>=1.1.1\n","  Downloading frozenlist-1.3.0-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (144 kB)\n","\u001b[K     |████████████████████████████████| 144 kB 52.3 MB/s \n","\u001b[?25hRequirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests>=2.0->line_bot_sdk) (2.10)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests>=2.0->line_bot_sdk) (2021.10.8)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests>=2.0->line_bot_sdk) (1.24.3)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests>=2.0->line_bot_sdk) (3.0.4)\n","Installing collected packages: multidict, frozenlist, yarl, asynctest, async-timeout, aiosignal, aiohttp, line-bot-sdk\n","Successfully installed aiohttp-3.8.1 aiosignal-1.2.0 async-timeout-4.0.2 asynctest-0.13.0 frozenlist-1.3.0 line-bot-sdk-2.2.1 multidict-6.0.2 yarl-1.7.2\n"]}]},{"cell_type":"code","execution_count":4,"metadata":{"id":"XS6pEKMXLzTx","executionInfo":{"status":"ok","timestamp":1652861492204,"user_tz":-480,"elapsed":4,"user":{"displayName":"","userId":""}},"outputId":"85cb2d90-55bd-4d75-b74f-5418bc97ff2c","colab":{"base_uri":"https://localhost:8080/","height":36}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["'\\n建圖文選單 \\n json\\n 圖片\\n 圖文選單id正式運作\\n把用戶跟圖文選單綁定在一起\\n解除綁定\\n瀏覽目前有多少張圖文選單\\n'"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"}},"metadata":{},"execution_count":4}],"source":["\n","'''\n","\n","用channel_access_token創建line_bot_api，預備用來跟Line進行溝通\n","\n","'''\n","\n","from linebot import (\n","    LineBotApi, WebhookHandler\n",")\n","\n","line_bot_api = LineBotApi(\"lSRXXK98162m7Q+kBr64eBxc9tV9FaNDf5cUXtDF2M8ljxITO86UTkf0MyMROwaA5aU3NGhN7ic+DswXldXarwEhuFaJP2I/T+3/OEGYK6mPkXr9pi8kMKrq9gntscNDRQRe40ZjpoWM/UqW7l1LbAdB04t89/1O/w1cDnyilFU=\")\n","\n","\"\"\"\n","建圖文選單 \n"," json\n"," 圖片\n"," 圖文選單id正式運作\n","把用戶跟圖文選單綁定在一起\n","解除綁定\n","瀏覽目前有多少張圖文選單\n","\"\"\"\n"]},{"cell_type":"code","execution_count":5,"metadata":{"id":"WvqyTF9uLzTy","executionInfo":{"status":"ok","timestamp":1652861495581,"user_tz":-480,"elapsed":894,"user":{"displayName":"","userId":""}},"outputId":"8df73deb-43fd-4db3-98d6-35f2cf59263e","colab":{"base_uri":"https://localhost:8080/"}},"outputs":[{"output_type":"stream","name":"stdout","text":["richmenu-ab77183abe3fde6e89f0f90f5c6f6b22\n"]}],"source":["'''\n","\n","載入前面的圖文選單設定，\n","\n","並要求line_bot_api將圖文選單上傳至Line\n","    \n","\n","'''\n","\n","from linebot.models import RichMenu\n","import requests\n","import json\n","# 讀取圖文選單設定檔\n","menuJson=json.loads(menuRawData)\n","#用line_bot_api的create_rich_menu方法，創造圖文選單id\n","# rich_menu : RichMenu\n","# new_form_json_dict 可以從json裡面生成RichMenu物件\n","lineRichMenuId = line_bot_api.create_rich_menu(rich_menu=RichMenu.new_from_json_dict(menuJson))\n","print(lineRichMenuId)"]},{"cell_type":"code","execution_count":6,"metadata":{"id":"AxjJwsVELzTy","executionInfo":{"status":"ok","timestamp":1652861755678,"user_tz":-480,"elapsed":1683,"user":{"displayName":"","userId":""}},"outputId":"f0f36d9d-bdca-4907-d980-8a23b660d50d","colab":{"base_uri":"https://localhost:8080/"}},"outputs":[{"output_type":"stream","name":"stdout","text":["None\n"]}],"source":["'''\n","\n","將先前準備的菜單照片，以Post消息寄發給Line\n","\n","    載入照片\n","    要求line_bot_api，將圖片傳到先前的圖文選單id\n","\n","圖文選單ID要好好保存起來，通常會保存到資料庫\n","richmenu-ab77183abe3fde6e89f0f90f5c6f6b22\n","\n","'''\n","\n","# 讀取圖檔\n","uploadImageFile=open(\"blockchain_demo.jpg\",'rb')\n","\n","# 讓line_bot_api上傳照片，把那個生成的id和圖文選單的照片綁在一起\n","setImageResponse = line_bot_api.set_rich_menu_image(lineRichMenuId,'image/jpeg',uploadImageFile)\n","\n","print(setImageResponse)"]},{"cell_type":"code","execution_count":7,"metadata":{"id":"dR3yNm5WLzTz","executionInfo":{"status":"ok","timestamp":1652861865715,"user_tz":-480,"elapsed":714,"user":{"displayName":"","userId":""}},"outputId":"7b849766-ba10-45ae-a586-dd50d58871de","colab":{"base_uri":"https://localhost:8080/"}},"outputs":[{"output_type":"stream","name":"stdout","text":["None\n"]}],"source":["'''\n","\n","將選單綁定到特定用戶身上\n","    取出上面得到的菜單Id及用戶id\n","    要求line_bot_api告知Line，將用戶與圖文選單做綁定\n","\n","'''\n","\n","# https://api.line.me/v2/bot/user/{userId}/richmenu/{richMenuId}\n","\n","# 讓line_bot_api告知line把圖文選單給指定的user\n","linkResult=line_bot_api.link_rich_menu_to_user(\"Uf57398b2870127a0567cc1fc518d93e0\", lineRichMenuId)\n","\n","print(linkResult)"]},{"cell_type":"code","execution_count":8,"metadata":{"id":"vBKiS4jpLzTz","executionInfo":{"status":"ok","timestamp":1652861929549,"user_tz":-480,"elapsed":805,"user":{"displayName":"","userId":""}},"outputId":"4ecfabdd-97b4-4af3-cd0f-5ba1612ec7e5","colab":{"base_uri":"https://localhost:8080/"}},"outputs":[{"output_type":"stream","name":"stdout","text":["richmenu-ab77183abe3fde6e89f0f90f5c6f6b22\n"]}],"source":["'''\n","\n","檢視用戶目前所綁定的菜單\n","    取出用戶id，並告知line_bot_api，\n","    line_bot_api傳回用戶所綁定的菜單\n","    印出\n","\n","'''\n","\n","#  https://api.line.me/v2/bot/user/{userId}/richmenu\n","\n","# 查詢特定用戶所使用的圖文選單\n","rich_menu_id = line_bot_api.get_rich_menu_id_of_user(\"Uf57398b2870127a0567cc1fc518d93e0\")\n","print(rich_menu_id)"]},{"cell_type":"code","execution_count":10,"metadata":{"id":"6urWoY8NLzT0","executionInfo":{"status":"ok","timestamp":1652862000055,"user_tz":-480,"elapsed":289,"user":{"displayName":"","userId":""}},"outputId":"e38a559f-6096-46ec-ae25-0f2211893471","colab":{"base_uri":"https://localhost:8080/"}},"outputs":[{"output_type":"stream","name":"stdout","text":["None\n"]}],"source":["'''\n","\n","解除選單與特定用戶的綁定\n","    取出用戶id，並告知line_bot_api，\n","    line_bot_api解除用戶所綁定的菜單\n","'''\n","\n","# 解除用戶的圖文選單綁定\n","# 參數: 要填寫的用戶ID\n","lineUnregisterUserMenuResponse=line_bot_api.unlink_rich_menu_from_user(\"Uf57398b2870127a0567cc1fc518d93e0\")\n","print(lineUnregisterUserMenuResponse)"]},{"cell_type":"code","execution_count":11,"metadata":{"id":"OtUQ5o0TLzT1","executionInfo":{"status":"ok","timestamp":1652862071720,"user_tz":-480,"elapsed":733,"user":{"displayName":"","userId":""}},"outputId":"15cc39a6-efaf-4d7a-e704-a53dfc371f0d","colab":{"base_uri":"https://localhost:8080/"}},"outputs":[{"output_type":"stream","name":"stdout","text":["richmenu-ab77183abe3fde6e89f0f90f5c6f6b22\n"]}],"source":["'''\n","\n","檢視帳號內，有哪些選單\n","    要求line_bot_api，向line查詢我方的圖文選單列表\n","    打印\n","\n","'''\n","# 查詢現有的圖文選單\n","rich_menu_list = line_bot_api.get_rich_menu_list()\n","for rich_menu in rich_menu_list:\n","    print(rich_menu.rich_menu_id)"]}],"metadata":{"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.8.6"},"colab":{"name":"「015_圖文選單建置.ipynb」的副本","provenance":[{"file_id":"https://github.com/BingHongLi/ai-chatbot-tutorial/blob/main/015_%E5%9C%96%E6%96%87%E9%81%B8%E5%96%AE%E5%BB%BA%E7%BD%AE.ipynb","timestamp":1652862087116}]}},"nbformat":4,"nbformat_minor":0}